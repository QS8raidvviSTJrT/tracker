<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="apple-mobile-web-app-title" content="DoorTrack" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <title>Door Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script defer src="app.js"></script>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://cloud.umami.is/script.js" data-website-id="7d58dfe9-7bf0-4e42-95a2-8d3f8ab66d3c"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=add_box" />
</head>
<body>
    <div class="login-container" id="loginContainer">
        <img src="120.png" alt="Door Tracker Logo">
        <h2>Door Tracker</h2>
        <input type="email" id="loginEmail" placeholder="E-Mail-Adresse">
        <input type="password" id="loginPassword" placeholder="Passwort">
        <a href="/recovery/" id="resetText"><u>Passwort vergessen?</u></a>
        <div class="button-container">
            <button onclick="login()" class="loginbutton" id="login">Einloggen</button>
            <button onclick="register()" class="registerbutton hidden" id="register">Registrieren</button>
        </div>        
        <div id="registerText"><a onclick="registerNow()">Neu bei Door Tracker? <u>Konto erstellen</u></a></div>
        
        <!-- Install App Popup -->
        <div id="installPopup" class="install-popup">
            <p id="installMessage">Installieren Sie diese App auf Ihrem Startbildschirm für schnellen Zugriff und ein besseres Erlebnis.</p>
            <button id="installButton">Installieren</button>
            <!--<button id="closePopupButton" class="close-popup"><span class="material-icons" style="font-size: 20px; color: white;">close</span></button>-->
        </div>
    </div>

    <div class="app-container" id="appContainer">
        <header class="app-header">
             <h2 id="currentViewTitle">Suche</h2>
             <div class="header-controls">
                <input type="text" id="plzInput" placeholder="PLZ" pattern="\d{5}" inputmode="numeric">
                <button onclick="searchStreets()" id="searchStreetButton" aria-label="Straßen suchen">
                     <span class="material-icons">search</span>
                </button>
               
             </div>
        </header>

        <div id="viewContainer">

            <div id="mainView" class="view active-view">
                <div id="alphabetFilterContainer" class="alphabet-filter-container" style="display: none;">
                    <!-- Alphabet-Buttons werden hier von JS eingefügt -->
                </div>
                <div id="streetListContainer" class="street-list-container">
                    <div id="streetListPlaceholder" class="list-placeholder">
                        <span class="material-icons placeholder-icon">search</span>
                        <p>Geben Sie oben eine Postleitzahl ein und klicken Sie auf die Lupe, um nach Straßen zu suchen.</p>
                    </div>
                    <!-- Straßenliste wird hier dynamisch eingefügt -->
                </div>
                <div id="streetDetailContainer" class="street-detail-container" style="display: none;">
                    <!-- Inhalt wird dynamisch von JS erzeugt -->
                </div>
                <div id="loadingIndicator" style="display: none; margin-top: 15px;">Lade...</div>
                <div id="errorDisplay" style="color: var(--danger-color); margin-top: 15px; display: none;"></div>
            </div>

            <div id="statsView" class="view">
                <div id="statsLoadingIndicator" class="loading-indicator-view" style="display: none;">Lade Statistiken...</div>
                <div id="statsErrorDisplay" class="error-display-view" style="display: none;"></div>
                <div id="statsContent" style="display: none;">
                    <div class="content-card">
                        <h2>Deine Statistik</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value" id="statTotalEntries">0</span>
                                <span class="stat-label">Häuser gesamt</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="statCompletedEntries">0</span>
                                <span class="stat-label">Abgeschlossen</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="statInterestedEntries">0</span>
                                <span class="stat-label">Interessiert</span>
                            </div>
                             <div class="stat-item">
                                <span class="stat-value" id="statNotInterestedEntries">0</span>
                                <span class="stat-label">Kein Interesse</span>
                            </div>
                             <div class="stat-item">
                                <span class="stat-value" id="statRevisitEntries">0</span>
                                <span class="stat-label">Erneut besuchen</span>
                            </div>
                             <div class="stat-item">
                                <span class="stat-value" id="statNotMetEntries">0</span>
                                <span class="stat-label">Nicht angetroffen</span>
                            </div>
                        </div>
                    </div>
                    <div class="content-card">
                        <h2>Status Verteilung</h2>
                        <div class="chart-container">
                             <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="leaderboardView" class="view">
                <div id="leaderboardLoadingIndicator" class="loading-indicator-view" style="display: none;">Lade Leaderboard...</div>
                <div id="leaderboardErrorDisplay" class="error-display-view" style="display: none;"></div>
                <div id="leaderboardContent" style="display: none;">
                    <div class="content-card">
                        <h2>Leaderboard (Top 50 Abschlüsse)</h2>
                        <div class="table-container">
                            <table id="leaderboardTable">
                                <thead>
                                    <tr>
                                        <th>Rang</th>
                                        <th>Name</th>
                                        <th>Abschlüsse</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Leaderboard-Zeilen werden hier dynamisch eingefügt -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settingsView" class="view">
                <div id="settingsLoadingIndicator" class="loading-indicator-view" style="display: none;">Lade Einstellungen...</div>
                <div id="settingsErrorDisplay" class="error-display-view" style="display: none;"></div>
                <div id="settingsContent" style="display: none;">
                    <div class="content-card">
                        <h2>Einstellungen</h2>
                        <div class="settings-form">
                            <label for="displayNameInput">Anzeigename (für Leaderboard):</label>
                            <input type="text" id="displayNameInput" placeholder="Dein Name/Nickname">
                            <button onclick="saveSettings()" id="saveSettingsButton">Namen speichern</button>
                            <p id="settingsStatus" style="margin-top: 10px; font-size: 0.9em;"></p>
                        </div>
                        <hr style="margin: 25px 0; border: none; border-top: 1px solid var(--card-border);">
                        <button onclick="logout()" class="settings-logout-button">
                            <span class="material-icons">logout</span> Ausloggen
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchView('mainView', 'Straßen')">
                <span class="material-icons">home</span>
                <span>Straßen</span>
            </button>
            <button class="nav-item" onclick="switchView('statsView', 'Statistik')">
                <span class="material-icons">bar_chart</span>
                <span>Statistik</span>
            </button>
            <button class="nav-item" onclick="switchView('leaderboardView', 'Leaderboard')">
                <span class="material-icons">leaderboard</span>
                <span>Leaderboard</span>
            </button>
            <button class="nav-item" onclick="switchView('settingsView', 'Einstellungen')">
                <span class="material-icons">settings</span>
                <span>Einstellungen</span>
            </button>
        </nav>

    </div>

    

    
</body>
</html>